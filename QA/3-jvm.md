# JVM

### Q:JRE,JDK,JVM是什么？
A:JRE 是Java应用运行的最小环境，jvm和一些类库组成。  
JDK 是Java开发的最小环境，由JRE和Java工具共同组成。  
JVM 即Java Virtual Machine是一台执行Java字节码指令的虚拟计算机，并不是Java语言才能生生字节码指令。  
jvm有良好的跨语言性，强大的垃圾回收机制和可靠的即时编译器，让JVM真正的能够坐到一次编译，处处运行。  
所有的Java程序都将运行在Java虚拟机的内部，但是JVM是运行在操作系统之上的摩根底层的硬件没有直接的做交互。  

### Q:说一说JVM的整体结构。
A:JVM整体可用分为：类加载子系统，运行时数据区，执行引擎和本地方法接口。    
其中类加载子系统负责将class文件加载进入JVM中运行，整个加载过程分为加载、链接和初始化。    
执行引擎可以分成三个部分，解释器、即时编译器和垃圾回收器三个部分。  
本地方法接口则是调用C/C++语言编写的底层native方法。  

### Q:说一说类加载子系统。
Java虚拟机把描述类的数据从Class文件加载到内存，对数据进行校验、转换解析和初始化，这个过程就叫虚拟机的类加载。  
Java中的类加载器有:启动类加载器 BootstrapClassLoader, 扩展类加载器 ExtensionClassLoader和应用程序类加载器 ApplicationClassLoader
双亲委派模型   
如果一个类加载器收到了加载类的请求，先不尝试去加载，而是把加载请求委派给父类加载器去完成，
父类加载器无法完成这个加载请求的时候才会反馈给子类加载器（负责的范围内没有搜索到所需的类），子类加载器才会去加载。
这样就保证了不会重复加载，也保证了核心类的安全，也就是常说的沙箱安全机制。  
  
加载完成之后是连接，连接分为验证、准备和解析三个阶段。
验证：
主要是确保Class文件不会危害到jvm自身的安全，比如说是不是以CAFEBABY开头，主次版本号有没有在虚拟机接收的范围之内。
也会进行一些简单的语义分析，继承的时候有没有把抽象类的方法都实现，是不是出现了final类被继承的错误等等。
一般在生产上，可以通过参数 -XVerify:none去关闭大部分的验证，缩短虚拟机加载类的时间。  

准备：
为类中定义的变量（被static修饰的变量）分配内存，并且初始化零值。
int类型是0， float类型是0.0 ，boolean 是false，char类型就是 -u0000，引用类型都是null。
但是不包括final修饰的变量，final类型的变量在编译的时候就赋值了。
而实例变量会随着对象实例化的时候随着对象一起分配在堆中。

解析：
解析要做的就是把常量池里面的符号引用转换为直接引用。符号引用就是一些字面量，直接引用要么是对象的地址，要么就是句柄。（句柄池里面的引用，间接定位对象地址）

初始化：
到这里的时候，虚拟机才把程序的流程控制交给代码，因为这里回去执行<clinit>方法，也就是类构造器，这个方法是编译的产物，但不是构造方法，构造方法是<init>
既然是交给程序执行，那么一定有线程安全问题，虚拟机会给这个方法加锁，保证初始化过程的线程安全。


  



























  



























